## Использование аппаратуры как джойстика для передачи каналов RC через mavlink

### Теория наземных станций, такие как Mission Planner 和 QGroundControl, способны распознавать подключенные джойстики аппаратур我们使用 USB-джойстика 和 передавать на полетный контроллер значения осей в пакете RC_CHANNELS_OVERRIDE (#70)。 Однако, QGC передает только первые 4 канала (две оси), остальное можно назначить только на кнопки, а MP может это делать тол在 Windows 上，请注意。 Я написал простейшее приложение для регистратора, которое распознает подключенный джойстик и отправляет пакеты [RC_CHANNELS] _OVERRIDE](https://mavlink.io/en/messages/common.html#RC_CHANNELS_OVERRIDE) 在 mavlink 2 для поддержки 18 каналов напрямую в порт telemetry_tx, который обычно опубликован на 127.0.0.1:14650 регистратора。请注意，请注意，请使用以下命令来操作“rcjoystick -h”。

```
Usage:
 [-v] verbose;
 [-d device] default '/dev/input/js0';
 [-a addr] ip address send to, default 127.0.0.1;
 [-p port] udp port send to, default 14650;
 [-t time] update RC_CHANNEL_OVERRIDE time in ms, default 50;
 [-x axes_count] 2..9 axes, default 5, other channels mapping to js buttons from button 0;
 [-r rssi_channel] store rx packets per second value to this channel, default 0 (disabled);
 [-i interface] wlan interface for rx packets statistics, default wlan0;

```

例如，telemetry_tx、mavlink_routerd 和 mavlink_routerd 都支持。请参阅 OpenIPC [тут](rcjoystick) 的 buildroot。

### Запускаем Нам необходимо ядро​​ 和 rootfs с поддержкой usb-hid на регистраторе. Для этого [прошейте](notes_start_hi3536ev100) их из [`/hi3536dv100`](hi3536dv100) каталога。 ~~Необходимо обеспечить запуск модуля `hid-generic.ko`, для этого добавьте `modprobe hid-generic.ko` в [`S95hisilicon`](hi3536dv100/etc/init.d/S95hisilicon).~~ В свежесобранном ядре модуль` hid-generic.ko` загружается автоматически。

Далее нужно скопировать бинарник [`rcjoystick`](hi3536dv100/usr/bin/rcjoystick) 位于 /usr/bin 目录下，через WinSCP 和 назначить права на е: `chmod +x /usr/bin/rcjoystick`。请注意，您可以使用 rcjoystick -v 来连接 USB 和 пробуем。 Если все прошло хорошо, то на экране мы должны увидеть значения осей при изменении положения стиков и переключателе ©, а в программе телеметрии, например в QGC（分析工具 > Mavlink 检查器 > RC_CHANNELS_RAW） должны изменяться каналы。 Для запуска на постоянную можно прописать его в отдельный сервис [`S99rcjoystick`](hi3536dv100/etc/init.d/S99rcjoystick), главное чтоы запускался после wifibroadcast。

### RSSI

Также в rcjoystick была добавлена функция инжекции аналога RSSI (числа полученных от воздушной части пакетов в секунду) для хоть какого то индикатора качества приема, так как отдельный сервис для этого заводить нет желания и смысла, учитывая невысокий уровень регистратора。 RCJoystick 可以在您的游戏中使用。

Указываем `-r 16` и, если интерфейс wfb не wlan0, то и его `-i wlanX` и в указанный канал будет попадать число принятых наземкой пакетов в секунду. У меня оно в районе 800, вы можете увидеть свое применив ключ verbose (`-v`). Далее указываем на полетнике:
```
RSSI_TYPE	2
RSSI_CHANNEL	16
RSSI_CHAN_LOW	0
RSSI_CHAN_HIGH	800 //ваше обычное значение, примерно среднее, не максимальное и не минимальное.
```
Указываем `-r 16` 和，以及 wfb не wlan0、то 和 его `-i wlanX` 和 в указанный канал будет попадать число принятых наземкой пакетов в секунду。 У меня оно в районе 800，вы можете увидеть свое применив ключ verbose (`-v`)。 Далее указываем на полетнике: Значение будет отправлено на полетник, где он его обработает и установит 0..99 в RSSI。

我们将在本次活动中为您提供帮助，并为您提供帮助。

### Текущие проблемы Иногда наблюдаются кратковременные фризы, если активно долбить оба стика во всех направлених. Дебаг говорит, что от драйвера не приходят в это время события о перемещении. arduino pro micro 的 sbus 转 USB 操纵杆SBUS 位于 USB-HID 操纵杆上。

